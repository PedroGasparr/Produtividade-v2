<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitar Hora Extra - ProdPlan</title>
    <!-- Importar Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #d6d6da 0%, #7d7881 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 900px;
        }

        .logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo h1 {
            color: #333;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .logo span {
            color: #667eea;
        }

        .user-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .user-info p {
            margin: 5px 0;
            color: #555;
            font-size: 0.9rem;
        }

        .tab-navigation {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #e1e5e9;
        }

        .tab-button {
            padding: 12px 24px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-section {
            margin-bottom: 25px;
        }

        .form-section h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            height: 100px;
            resize: vertical;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group input {
            width: auto;
        }

        .submit-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            margin-top: 10px;
        }

        .submit-btn:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .back-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .back-btn:hover {
            background: #5a6268;
        }

        .message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .required {
            color: #e74c3c;
        }

        .time-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .time-inputs input {
            flex: 1;
        }

        .time-separator {
            font-weight: bold;
            color: #333;
        }

        /* Estilos para a tela de acompanhamento */
        .requests-list {
            display: grid;
            gap: 15px;
        }

        .request-item {
            border: 2px solid #e1e5e9;
            border-radius: 12px;
            padding: 20px;
            background: white;
            transition: all 0.3s ease;
        }

        .request-item:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }

        .request-item.pendente {
            border-left: 6px solid #ffc107;
        }

        .request-item.aprovada {
            border-left: 6px solid #28a745;
        }

        .request-item.rejeitada {
            border-left: 6px solid #dc3545;
        }

        .request-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .request-info h3 {
            color: #333;
            margin-bottom: 5px;
        }

        .request-meta {
            color: #666;
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pendente {
            background: #fff3cd;
            color: #856404;
        }

        .status-aprovada {
            background: #d4edda;
            color: #155724;
        }

        .status-rejeitada {
            background: #f8d7da;
            color: #721c24;
        }

        .request-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-weight: 600;
            color: #555;
            font-size: 0.85rem;
            margin-bottom: 4px;
        }

        .detail-value {
            color: #333;
        }

        .rejection-reason {
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #dc3545;
        }

        .rejection-reason strong {
            color: #dc3545;
        }

        .no-requests {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 1.1rem;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        /* Estilos para o select de colaboradores */
        .employee-select-container {
            position: relative;
        }

        .employee-select-container select {
            appearance: none;
            background-image: url("data:image/svg+xml;charset=US-ASCII,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 4 5'><path fill='%23666' d='M2 0L0 2h4zm0 5L0 3h4z'/></svg>");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <h1>Prod<span>Plan</span></h1>
            <p>Solicitação de Hora Extra</p>
        </div>
        
        <div class="user-info">
            <p id="user-name">Carregando informações do usuário...</p>
            <p id="user-unit">Unidade: -</p>
            <p id="user-email">Email: -</p>
            <p id="user-type">Tipo de Conta: -</p>
        </div>

        <div id="message" class="message"></div>

        <div class="tab-navigation">
            <button class="tab-button active" data-tab="solicitar">Nova Solicitação</button>
            <button class="tab-button" data-tab="acompanhar">Minhas Solicitações</button>
        </div>

        <!-- Tab 1: Nova Solicitação -->
        <div id="solicitar-tab" class="tab-content active">
            <form id="overtime-form">
                <div class="form-section">
                    <h2>Dados da Solicitação</h2>
                    
                    <div class="form-row">
                        <div class="form-group employee-select-container">
                            <label for="employee-name">Nome do Funcionário <span class="required">*</span></label>
                            <select id="employee-name" required>
                                <option value="">Selecione um colaborador</option>
                                <!-- Os colaboradores serão carregados aqui via JavaScript -->
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="work-area">Área de Trabalho <span class="required">*</span></label>
                            <select id="work-area" required>
                                <option value="">Selecione a área</option>
                                <option value="logistica">Logística</option>
                                <option value="suprimentos">Suprimentos</option>
                                <option value="producao">Produção</option>
                                <option value="qualidade">Qualidade</option>
                                <option value="manutencao">Manutenção</option>
                                <option value="administrativo">Administrativo</option>
                                <option value="rh">Recursos Humanos</option>
                                <option value="ti">Tecnologia da Informação</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="unit">Unidade <span class="required">*</span></label>
                            <input type="text" id="unit" readonly>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="date">Data da Hora Extra <span class="required">*</span></label>
                            <input type="date" id="date" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="function">Função na Hora Extra <span class="required">*</span></label>
                            <select id="function" required>
                                <option value="">Selecione a função</option>
                                <option value="operador_empilhadeira">Operador de Empilhadeira</option>
                                <option value="auxiliar_producao">Auxiliar de Produção</option>
                                <option value="conferente">Conferente</option>
                                <option value="separador">Separador</option>
                                <option value="embalador">Embalador</option>
                                <option value="operador_maquina">Operador de Máquina</option>
                                <option value="tecnico_manutencao">Técnico de Manutenção</option>
                                <option value="supervisor">Supervisor</option>
                                <option value="analista">Analista</option>
                                <option value="coordenador">Coordenador</option>
                                <option value="outro">Outro</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="start-time">Horário de Início <span class="required">*</span></label>
                            <input type="time" id="start-time" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="end-time">Horário de Término <span class="required">*</span></label>
                            <input type="time" id="end-time" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="total-hours">Total de Horas</label>
                            <input type="text" id="total-hours" readonly placeholder="Calculado automaticamente">
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <h2>Detalhes da Solicitação</h2>
                    
                    <div class="form-group">
                        <label for="reason">Motivo da Hora Extra <span class="required">*</span></label>
                        <select id="reason" required>
                            <option value="">Selecione o motivo</option>
                            <option value="demanda_operacional">Demanda Operacional</option>
                            <option value="atraso_producao">Atraso na Produção</option>
                            <option value="entrega_urgente">Entrega Urgente</option>
                            <option value="falta_pessoal">Falta de Pessoal</option>
                            <option value="manutencao_equipamento">Manutenção de Equipamento</option>
                            <option value="inventario">Inventário</option>
                            <option value="projeto_especial">Projeto Especial</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>

                    <div class="form-group" id="other-reason-container" style="display: none;">
                        <label for="other-reason">Especifique o motivo <span class="required">*</span></label>
                        <input type="text" id="other-reason" placeholder="Digite o motivo específico">
                    </div>

                    <div class="form-group">
                        <label for="description">Descrição Detalhada <span class="required">*</span></label>
                        <textarea id="description" placeholder="Descreva em detalhes a necessidade da hora extra, atividades a serem realizadas e justificativa..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="supervisor">Supervisor Imediato <span class="required">*</span></label>
                        <input type="text" id="supervisor" placeholder="Nome do supervisor" required>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="emergency" name="emergency">
                        <label for="emergency">Hora Extra Emergencial</label>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="weekend" name="weekend">
                        <label for="weekend">Hora Extra em Final de Semana</label>
                    </div>
                </div>

                <button type="submit" class="submit-btn">Solicitar Hora Extra</button>
            </form>
        </div>

        <!-- Tab 2: Acompanhamento -->
        <div id="acompanhar-tab" class="tab-content">
            <div class="form-section">
                <h2>Minhas Solicitações</h2>
                <div id="my-requests-container">
                    <div class="loading" id="loading-requests">
                        Carregando suas solicitações...
                    </div>
                </div>
            </div>
        </div>

        <button type="button" class="back-btn" onclick="voltarParaMenu()">Voltar para o Menu</button>
    </div>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCMu17OV-5ST1rlg00zbpt6Hv37GKqkX4A",
            authDomain: "projetos-d868d.firebaseapp.com",
            databaseURL: "https://projetos-d868d-default-rtdb.firebaseio.com",
            projectId: "projetos-d868d",
            storageBucket: "projetos-d868d.firebasestorage.app",
            messagingSenderId: "420029352781",
            appId: "1:420029352781:web:05176699348e0ccdd78504",
            measurementId: "G-FXWXRX04WF"
        };
        
        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        // Elementos do DOM
        const userInfo = {
            name: document.getElementById('user-name'),
            unit: document.getElementById('user-unit'),
            email: document.getElementById('user-email'),
            type: document.getElementById('user-type')
        };

        const form = document.getElementById('overtime-form');
        const messageDiv = document.getElementById('message');
        const unitInput = document.getElementById('unit');
        const employeeSelect = document.getElementById('employee-name');
        const reasonSelect = document.getElementById('reason');
        const otherReasonContainer = document.getElementById('other-reason-container');
        const startTimeInput = document.getElementById('start-time');
        const endTimeInput = document.getElementById('end-time');
        const totalHoursInput = document.getElementById('total-hours');
        const workAreaSelect = document.getElementById('work-area');
        const functionSelect = document.getElementById('function');
        const myRequestsContainer = document.getElementById('my-requests-container');
        const loadingRequests = document.getElementById('loading-requests');
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        // Estado da aplicação
        let currentUser = null;
        let userData = null;
        let currentUnit = '';
        let isClientAccount = false;
        let colaboradores = [];

        // Verificar autenticação
        auth.onAuthStateChanged((user) => {
            if (user) {
                currentUser = user;
                
                // Buscar dados do usuário no Firestore
                db.collection('users').doc(user.uid).get()
                .then((doc) => {
                    if (doc.exists) {
                        userData = doc.data();
                        currentUnit = userData.unit;
                        isClientAccount = userData.userType === 'cliente';
                        
                        // Atualizar informações do usuário
                        userInfo.name.textContent = `Usuário: ${userData.name}`;
                        userInfo.unit.textContent = `Unidade: ${currentUnit}`;
                        userInfo.email.textContent = `Email: ${user.email}`;
                        userInfo.type.textContent = `Tipo de Conta: ${isClientAccount ? 'Cliente' : 'Colaborador'}`;
                        
                        // Preencher unidade no formulário
                        unitInput.value = currentUnit;
                        
                        // Carregar colaboradores da unidade
                        carregarColaboradores();
                        
                    } else {
                        showMessage('Erro: Dados do usuário não encontrados.', 'error');
                    }
                })
                .catch((error) => {
                    console.error("Erro ao buscar dados do usuário:", error);
                    showMessage('Erro ao carregar dados do usuário.', 'error');
                });
            } else {
                // Usuário não autenticado, redirecionar para login
                window.location.href = '../index.html';
            }
        });

        // Carregar colaboradores da unidade
        function carregarColaboradores() {
            db.collection('colaboradores_he')
                .where('unit', '==', currentUnit)
                .orderBy('name')
                .get()
                .then((snapshot) => {
                    colaboradores = [];
                    employeeSelect.innerHTML = '<option value="">Selecione um colaborador</option>';
                    
                    if (snapshot.empty) {
                        employeeSelect.innerHTML += '<option value="" disabled>Nenhum colaborador cadastrado nesta unidade</option>';
                        showMessage('Nenhum colaborador cadastrado na sua unidade. Entre em contato com o administrador.', 'error');
                        return;
                    }

                    snapshot.forEach((doc) => {
                        const colaborador = {
                            id: doc.id,
                            ...doc.data()
                        };
                        colaboradores.push(colaborador);
                        
                        // Adicionar opção ao select
                        const option = document.createElement('option');
                        option.value = colaborador.name;
                        option.textContent = colaborador.name;
                        employeeSelect.appendChild(option);
                    });
                    
                    showMessage(`${colaboradores.length} colaboradores carregados da unidade.`, 'success');
                    setTimeout(() => hideMessage(), 3000);
                })
                .catch((error) => {
                    console.error("Erro ao carregar colaboradores:", error);
                    employeeSelect.innerHTML = '<option value="" disabled>Erro ao carregar colaboradores</option>';
                    showMessage('Erro ao carregar lista de colaboradores.', 'error');
                });
        }

        // Navegação entre abas
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                const tabId = button.getAttribute('data-tab');
                
                // Ativar aba clicada
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                button.classList.add('active');
                document.getElementById(`${tabId}-tab`).classList.add('active');
                
                // Se for a aba de acompanhamento, carregar as solicitações
                if (tabId === 'acompanhar') {
                    carregarMinhasSolicitacoes();
                }
            });
        });

        // Mostrar/ocultar campo de outro motivo
        reasonSelect.addEventListener('change', function() {
            if (this.value === 'outro') {
                otherReasonContainer.style.display = 'block';
            } else {
                otherReasonContainer.style.display = 'none';
            }
        });

        // Calcular horas totais automaticamente
        startTimeInput.addEventListener('change', calculateTotalHours);
        endTimeInput.addEventListener('change', calculateTotalHours);

        function calculateTotalHours() {
            const startTime = startTimeInput.value;
            const endTime = endTimeInput.value;
            
            if (startTime && endTime) {
                const start = new Date(`2000-01-01T${startTime}`);
                const end = new Date(`2000-01-01T${endTime}`);
                
                // Se o horário final for menor que o inicial, assume que passa para o dia seguinte
                if (end < start) {
                    end.setDate(end.getDate() + 1);
                }
                
                const diffMs = end - start;
                const diffHours = diffMs / (1000 * 60 * 60);
                
                totalHoursInput.value = diffHours.toFixed(2) + ' horas';
            }
        }

        // Funções para mostrar mensagens
        function showMessage(message, type) {
            messageDiv.textContent = message;
            messageDiv.className = `message ${type}`;
            messageDiv.style.display = 'block';
            
            // Auto-esconder após 5 segundos
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        function hideMessage() {
            messageDiv.style.display = 'none';
        }

        // Enviar formulário de solicitação de hora extra
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Determinar o status baseado no tipo de conta
            const status = isClientAccount ? 'aprovada' : 'pendente';
            
            // Coletar dados do formulário
            const formData = {
                employeeName: employeeSelect.value,
                workArea: workAreaSelect.value,
                function: functionSelect.value,
                date: document.getElementById('date').value,
                startTime: startTimeInput.value,
                endTime: endTimeInput.value,
                totalHours: totalHoursInput.value,
                unit: unitInput.value,
                reason: reasonSelect.value,
                description: document.getElementById('description').value.trim(),
                supervisor: document.getElementById('supervisor').value.trim(),
                emergency: document.getElementById('emergency').checked,
                weekend: document.getElementById('weekend').checked,
                status: status,
                createdAt: new Date(),
                createdBy: currentUser.uid,
                createdByName: userData.name,
                userType: userData.userType || "colaborador",
                approvedAt: isClientAccount ? new Date() : null,
                approvedBy: isClientAccount ? 'Sistema' : null
            };

            // Se o motivo for "outro", usar o texto específico
            if (formData.reason === 'outro') {
                formData.reason = document.getElementById('other-reason').value.trim();
                if (!formData.reason) {
                    showMessage('Por favor, especifique o motivo da hora extra.', 'error');
                    return;
                }
            }

            // VALIDAÇÃO SIMPLES - APENAS CAMPOS OBRIGATÓRIOS
            if (!formData.employeeName || !formData.workArea || !formData.function || 
                !formData.date || !formData.startTime || !formData.endTime || 
                !formData.description || !formData.supervisor) {
                showMessage('Por favor, preencha todos os campos obrigatórios.', 'error');
                return;
            }

            // VALIDAÇÃO APENAS DE HORÁRIOS (sem validação de data)
            if (formData.startTime >= formData.endTime) {
                showMessage('O horário de término deve ser após o horário de início.', 'error');
                return;
            }

            // Salvar no Firestore
            db.collection('solicitacoes_HE').add(formData)
                .then((docRef) => {
                    if (isClientAccount) {
                        showMessage('Solicitação de hora extra APROVADA automaticamente!', 'success');
                    } else {
                        showMessage('Solicitação de hora extra enviada com sucesso! Aguarde a aprovação.', 'success');
                    }
                    form.reset();
                    unitInput.value = currentUnit;
                    calculateTotalHours();
                    
                    // Ir para aba de acompanhamento
                    document.querySelector('[data-tab="acompanhar"]').click();
                })
                .catch((error) => {
                    console.error('Erro ao enviar solicitação:', error);
                    showMessage('Erro ao enviar solicitação. Tente novamente.', 'error');
                });
        });

        // Carregar minhas solicitações
        function carregarMinhasSolicitacoes() {
            loadingRequests.style.display = 'block';
            myRequestsContainer.innerHTML = '';
            myRequestsContainer.appendChild(loadingRequests);

            db.collection('solicitacoes_HE')
                .where('createdBy', '==', currentUser.uid)
                .orderBy('createdAt', 'desc')
                .get()
                .then((snapshot) => {
                    loadingRequests.style.display = 'none';
                    
                    if (snapshot.empty) {
                        myRequestsContainer.innerHTML = '<div class="no-requests">Nenhuma solicitação encontrada.</div>';
                        return;
                    }

                    snapshot.forEach((doc) => {
                        const request = {
                            id: doc.id,
                            ...doc.data()
                        };
                        const requestElement = criarElementoSolicitacao(request);
                        myRequestsContainer.appendChild(requestElement);
                    });
                })
                .catch((error) => {
                    console.error('Erro ao carregar solicitações:', error);
                    loadingRequests.style.display = 'none';
                    myRequestsContainer.innerHTML = '<div class="no-requests">Erro ao carregar solicitações.</div>';
                });
        }

        // Criar elemento de solicitação para a lista
        function criarElementoSolicitacao(request) {
            const element = document.createElement('div');
            element.className = `request-item ${request.status}`;
            
            const areaNames = {
                'logistica': 'Logística', 'suprimentos': 'Suprimentos', 'producao': 'Produção',
                'qualidade': 'Qualidade', 'manutencao': 'Manutenção', 'administrativo': 'Administrativo',
                'rh': 'Recursos Humanos', 'ti': 'Tecnologia da Informação', 'outro': 'Outro'
            };
            
            const functionNames = {
                'operador_empilhadeira': 'Operador de Empilhadeira', 'auxiliar_producao': 'Auxiliar de Produção',
                'conferente': 'Conferente', 'separador': 'Separador', 'embalador': 'Embalador',
                'operador_maquina': 'Operador de Máquina', 'tecnico_manutencao': 'Técnico de Manutenção',
                'supervisor': 'Supervisor', 'analista': 'Analista', 'coordenador': 'Coordenador', 'outro': 'Outro'
            };
            
            const statusNames = {
                'pendente': 'Pendente', 'aprovada': 'Aprovada', 'rejeitada': 'Rejeitada'
            };
            
            const statusClasses = {
                'pendente': 'status-pendente', 'aprovada': 'status-aprovada', 'rejeitada': 'status-rejeitada'
            };

            const data = request.date ? new Date(request.date + 'T00:00:00').toLocaleDateString('pt-BR') : 'N/A';
            const criadoEm = request.createdAt ? request.createdAt.toDate().toLocaleString('pt-BR') : 'N/A';
            const aprovadoEm = request.approvedAt ? request.approvedAt.toDate().toLocaleString('pt-BR') : 'N/A';

            element.innerHTML = `
                <div class="request-header">
                    <div class="request-info">
                        <h3>${request.employeeName}</h3>
                        <div class="request-meta">
                            ${areaNames[request.workArea] || request.workArea} • 
                            ${functionNames[request.function] || request.function} • 
                            ${data}
                        </div>
                    </div>
                    <div class="status-badge ${statusClasses[request.status]}">
                        ${statusNames[request.status]}
                    </div>
                </div>
                
                <div class="request-details">
                    <div class="detail-item">
                        <span class="detail-label">Horário</span>
                        <span class="detail-value">${request.startTime} - ${request.endTime} (${request.totalHours})</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Supervisor</span>
                        <span class="detail-value">${request.supervisor}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Motivo</span>
                        <span class="detail-value">${request.reason}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Solicitado em</span>
                        <span class="detail-value">${criadoEm}</span>
                    </div>
                    ${request.approvedAt ? `
                    <div class="detail-item">
                        <span class="detail-label">Aprovado em</span>
                        <span class="detail-value">${aprovadoEm}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Aprovado por</span>
                        <span class="detail-value">${request.approvedBy || 'Sistema'}</span>
                    </div>
                    ` : ''}
                </div>
                
                ${request.rejectionReason ? `
                <div class="rejection-reason">
                    <strong>Motivo da Rejeição:</strong> ${request.rejectionReason}
                </div>
                ` : ''}
            `;

            return element;
        }

        // Função para voltar ao menu
        function voltarParaMenu() {
            window.location.href = 'menu.html';
        }

        // Configurar data mínima como hoje (apenas para UX, sem validação)
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('date').min = today;

        // Configurar horários padrão (início às 18:00, término às 22:00)
        startTimeInput.value = '18:00';
        endTimeInput.value = '22:00';
        calculateTotalHours();
    </script>
</body>
</html>